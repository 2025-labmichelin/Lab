<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Resultado do Diagn√≥stico</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f9; padding: 2rem; }
    header {
      background-color: #002c5f;
      color: white;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 2rem;
    }
    .resultado-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: flex-start;
      margin-bottom: 2rem;
    }
    .raquel-box {
      display: flex;
      align-items: center;
      gap: 1rem;
      background-color: #eaf0f6;
      border-left: 6px solid #2563eb;
      padding: 1.5rem;
      border-radius: 12px;
      flex: 1 1 300px;
    }
    .raquel-box img {
      border-radius: 50%;
      width: 80px;
    }
    .raquel-box h2 {
      margin: 0 0 0.25rem 0;
      color: #002c5f;
    }
    .raquel-box p {
      margin: 0;
      color: #002c5f;
    }
    .card-descricao-release {
      background-color: #ffffff;
      border-left: 6px solid #4caf50;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      flex: 1 1 300px;
    }
    .card-descricao-release h4 {
      color: #002c5f;
      margin-top: 0;
    }
    .card-descricao-release p {
      color: #333;
      margin-top: 0.5rem;
      line-height: 1.5;
    }
    .grafico-box {
      background-color: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      text-align: center;
      max-width: 700px;
    }
    canvas {
      max-width: 500px;
      margin: auto;
    }
    .botao-pdf {
      background: linear-gradient(90deg, #2563eb, #1e40af);
      color: white;
      padding: 0.75rem 1.75rem;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 2rem;
      display: none;
    }
    .botao-pdf:hover {
      background: linear-gradient(90deg, #4caf50, #388e3c);
    }
  </style>
</head>
<body>
<header>
  <h1>SmartCX ‚Ä¢ Resultado do Diagn√≥stico</h1>
</header>
<div id="resultadoCompleto">
  <div class="resultado-wrapper">
    <div class="raquel-box">
      <img src="../assets/raquel.png" alt="Raquel IA">
      <div>
        <h2 id="saudacaoRaquel"></h2>
        <p>J√° analisei suas respostas. A maturidade atual da sua empresa √©:</p>
        <h3 id="nivelMaturidade"></h3>
      </div>
    </div>
    <div class="card-descricao-release">
      <h4>Detalhes do n√≠vel atual</h4>
      <p id="descricaoRelease"></p>
    </div>
  </div>
  <div class="grafico-box">
    <p id="loading" style="text-align:center;">üîÑ Gerando gr√°fico e diagn√≥stico...</p>
    <canvas id="graficoResultado"></canvas>
  </div>
</div>
<div style="text-align: center;">
  <button class="botao-pdf" id="btnPdf" onclick="gerarPDF()">üìä Ver resultado em PDF</button>
</div>
<script>
  const respostas = JSON.parse(localStorage.getItem("respostasFormulario"));

  if (!respostas || !respostas.p1) {
    document.getElementById("resultadoCompleto").innerHTML = "<p style='text-align:center; color: red;'>N√£o encontramos as respostas do diagn√≥stico. Por favor, preencha o formul√°rio novamente.</p>";
    throw new Error("Respostas n√£o encontradas");
  }

  const nome = respostas?.responsavel || "Usu√°rio";
  const empresa = respostas?.empresa || "sua empresa";
  document.getElementById("saudacaoRaquel").innerText = `Oi, ${nome}!`;

  const p = [];
  let total = 0;
  for (let i = 1; i <= 10; i++) {
    const val = parseInt(respostas[`p${i}`]) || 0;
    p.push(val);
    total += val;
  }

  let nivel = "";
  let descricao = "";
  let corRelease = "#2563eb";

  if (total <= 10) {
    nivel = "Iniciando (Release 1)";
    descricao = "Atendimento reativo, canais isolados, sem automa√ß√£o ou m√©tricas estruturadas. Nesta primeira etapa, o foco √© colocar o contact center em opera√ß√£o com agilidade e seguran√ßa. S√£o ativados os canais principais de atendimento (voz, WhatsApp, Webchat), as ferramentas de supervis√£o e relat√≥rios, al√©m dos controles b√°sicos de acesso e seguran√ßa. √â a base para toda a evolu√ß√£o futura.";
    corRelease = "#ef4444";
  } else if (total <= 17) {
    nivel = "Emergente (Release 2)";
    descricao = "In√≠cio da automa√ß√£o com bots e intelig√™ncia artificial b√°sica. Os fluxos passam a ser estruturados de forma estrat√©gica, com roteamento inteligente e monitoramento de qualidade. O objetivo √© reduzir esfor√ßo humano, acelerar atendimentos e organizar melhor os processos.";
    corRelease = "#f97316";
  } else if (total <= 24) {
    nivel = "Eficiente (Release 3)";
    descricao = "A opera√ß√£o passa a ser guiada por dados, com an√°lise de sentimentos, desempenho por canal e relat√≥rios estrat√©gicos. Os agentes recebem suporte em tempo real com sugest√µes e transcri√ß√£o autom√°tica. Decis√µes passam a ser tomadas com base em insights operacionais.";
    corRelease = "#eab308";
  } else if (total <= 30) {
    nivel = "Inteligente (Release 4)";
    descricao = "A opera√ß√£o se torna mais inteligente e preditiva. Com a gest√£o da for√ßa de trabalho (WFM), agentes aut√¥nomos com IA generativa e seguran√ßa avan√ßada, a empresa ganha controle total sobre escalas, previs√µes e desempenho. √â a consolida√ß√£o de um contact center moderno e estrat√©gico.";
    corRelease = "#3b82f6";
  } else {
    nivel = "Avan√ßado (Release 5)";
    descricao = "Esta etapa atende clientes com necessidades espec√≠ficas. S√£o desenvolvidas solu√ß√µes sob medida, integra√ß√µes customizadas e fluxos exclusivos. A empresa ganha flexibilidade para adaptar o Talkdesk √† sua realidade, segmento e regras de neg√≥cio, com acompanhamento consultivo pr√≥ximo.";
    corRelease = "#10b981";
  }

  document.getElementById("nivelMaturidade").innerText = nivel;
  document.getElementById("descricaoRelease").innerText = descricao;

  const valoresRadar = [
    p[0] + p[1],
    p[2] + p[3],
    p[4] + p[5],
    p[6] + p[7],
    p[8] + p[9]
  ];

  const ctx = document.getElementById('graficoResultado').getContext('2d');
  const grafico = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: [
        "Estrat√©gia e Cultura",
        "Canais de Atendimento",
        "Processos e Pessoas",
        "Tecnologia e Automa√ß√£o",
        "Governan√ßa e Performance"
      ],
      datasets: [{
        label: "Pontua√ß√£o por dimens√£o",
        data: valoresRadar,
        backgroundColor: corRelease + "33",
        borderColor: corRelease,
        pointBackgroundColor: corRelease
      }]
    },
    options: {
      responsive: true,
      animation: {
        onComplete: () => {
          window.graficoPronto = true;
          document.getElementById("loading").style.display = "none";
          document.getElementById("btnPdf").style.display = "inline-block";
        }
      },
      scales: {
        r: {
          beginAtZero: true,
          max: 10,
          ticks: { stepSize: 2 }
        }
      }
    }
  });

  function gerarPDF() {
    if (!window.graficoPronto) {
      setTimeout(gerarPDF, 500);
      return;
    }
    const elemento = document.getElementById("resultadoCompleto");
    const opt = {
      margin: 0.5,
      filename: `Diagnostico_${empresa.replace(/\s+/g, '_')}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().from(elemento).set(opt).save();
  }
</script>
</body>
</html>
